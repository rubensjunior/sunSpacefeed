<!-- Wappler include head-page="layouts/backoffice" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="unidadespolos" appConnect="local" components="{dmxPreloader:{},dmxBootstrap5TableGenerator:{},dmxBootstrap5Modal:{},dmxDataTraversal:{}}" -->
<dmx-data-detail id="data_detail_polo" dmx-bind:data="minhasempresas.data.query_empresas" key="id_empresa"></dmx-data-detail>
<!-- Form state manager -->
<dmx-value id="modal_step" dmx-bind:value="1"></dmx-value>

<div class="modal fade" id="criar_modal_polo" is="dmx-bs5-modal" tabindex="-1" data-bs-theme="dark" nocloseonclick="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Adicionar polo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="modal_step.setValue(1);criar_form_unidade.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="criar_form_unidade" is="dmx-serverconnect-form" method="post" action="/api/negocios/empresa/nova-unidade" dmx-on:error="alertas.danger('Ocorreu um erro.')" dmx-on:success="minhasempresas.load({});criar_modal_polo.hide();criar_form_unidade.reset();alertas.success('Cadastro realizado com sucesso!')">
                    <input id="id_empresa_matriz" name="id_empresa_matriz" type="hidden" class="form-control" dmx-bind:value="meuusuario.data.dados_usuario.empresa_matriz">
                    <!-- Step 1: Company Data -->
                    <div id="step1" dmx-show="modal_step.value == 1">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="razao_social" class="form-label">Razão Social</label>
                                <input type="text" class="form-control" id="razao_social" name="razao_social" required="" data-msg-required="Por favor, informe a razão social">
                            </div>
                            <div class="col-md-6">
                                <label for="nome_fantasia" class="form-label">Nome Fantasia</label>
                                <input type="text" class="form-control" id="nome_fantasia" name="nome_fantasia" required="" data-msg-required="Por favor, informe o nome fantasia">
                            </div>
                            <div class="col-md-6">
                                <label for="nome_polo" class="form-label">Nome do Polo</label>
                                <input type="text" class="form-control" id="nome_polo" name="nome_polo" required="" data-msg-required="Por favor, informe o nome do polo">
                            </div>
                            <div class="col-md-6">
                                <label for="cnpj" class="form-label">CNPJ</label>
                                <input type="text" class="form-control" id="cnpj" name="cnpj" required="" data-msg-required="Por favor, informe o CNPJ" placeholder="00.000.000/0000-00">
                            </div>
                            <div class="col-md-6">
                                <label for="whatsapp" class="form-label">WhatsApp</label>
                                <input type="text" class="form-control" id="whatsapp" name="whatsapp" required="" data-msg-required="Por favor, informe o WhatsApp" placeholder="(00) 0 0000-0000">
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Address -->
                    <div id="step2" dmx-show="modal_step.value == 2">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="logradouro" class="form-label">Endereço completo</label>
                                <input type="text" class="form-control" id="logradouro" name="logradouro" required="" data-msg-required="Por favor, informe o endereço">
                            </div>
                            <div class="col-md-3">
                                <label for="numero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="numero" name="numero" required="" data-msg-required="Por favor, informe o número">
                            </div>
                            <div class="col-md-3">
                                <label for="cep" class="form-label">CEP</label>
                                <input type="text" class="form-control" id="cep" name="cep" placeholder="00000-000" required="" data-msg-required="Por favor, informe o CEP">
                            </div>
                            <div class="col-md-6">
                                <label for="complemento" class="form-label">Complemento</label>
                                <input type="text" class="form-control" id="complemento" name="complemento">
                            </div>
                            <div class="col-md-6">
                                <label for="bairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="bairro" name="bairro" required="" data-msg-required="Por favor, informe o bairro">
                            </div>
                            <div class="col-md-6">
                                <label for="cidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidade" name="cidade" required="" data-msg-required="Por favor, informe a cidade">
                            </div>
                            <div class="col-md-6">
                                <label for="estado" class="form-label">Estado</label>
                                <select class="form-select" id="estado" name="estado" required="" data-msg-required="Por favor, selecione o estado">
                                    <option value="">-- Selecione o Estado --</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amapá</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Ceará</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Pará</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="PR">Paraná</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piauí</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Navigation Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" dmx-show="modal_step.value == 2" dmx-on:click="modal_step.setValue(1)">Voltar</button>
                    <button type="button" class="btn btn-primary" dmx-show="modal_step.value == 1" dmx-on:click="modal_step.setValue(2)">Próximo</button>
                    <button class="btn btn-success" dmx-show="modal_step.value == 2" dmx-on:click="criar_form_unidade.submit()">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="editar_modal_polo" is="dmx-bs5-modal" tabindex="-1" data-bs-theme="dark" nocloseonclick="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar polo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="modal_step.setValue(1);data_detail_polo.select(0)"></button>
            </div>
            <div class="modal-body">
                <form id="editar_form_unidade" is="dmx-serverconnect-form" method="post" action="/api/negocios/empresa/atualizar-unidade" dmx-on:error="alertas.danger('Ocorreu um erro! Entre em contato com o suporte.')" dmx-on:success="minhasempresas.load({});editar_modal_polo.hide();data_detail_polo.select(0);modal_step.setValue(1);editar_form_unidade.reset()">
                    <input id="id_empresa_update" name="id_empresa_update" type="hidden" class="form-control" dmx-bind:value="data_detail_polo.data.id_empresa">
                    <!-- Step 1: Company Data -->
                    <div id="step3" dmx-show="modal_step.value == 1">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="editar_razao_social" class="form-label">Razão Social</label>
                                <input type="text" class="form-control" id="editar_razao_social" name="editar_razao_social" required="" data-msg-required="Por favor, informe a razão social" dmx-bind:value="data_detail_polo.data.razao_social">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_nome_fantasia" class="form-label">Nome Fantasia</label>
                                <input type="text" class="form-control" id="editar_nome_fantasia" name="editar_nome_fantasia" required="" data-msg-required="Por favor, informe o nome fantasia" dmx-bind:value="data_detail_polo.data.nome_fantasia">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_nome_polo" class="form-label">Nome do Polo</label>
                                <input type="text" class="form-control" id="editar_nome_polo" name="editar_nome_polo" required="" data-msg-required="Por favor, informe o nome do polo" dmx-bind:value="data_detail_polo.data.nome_polo">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_cnpj" class="form-label">CNPJ</label>
                                <input type="text" class="form-control" id="editar_cnpj" name="editar_cnpj" required="" data-msg-required="Por favor, informe o CNPJ" placeholder="00.000.000/0000-00" dmx-bind:value="data_detail_polo.data.cnpj">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_whatsapp" class="form-label">WhatsApp</label>
                                <input type="text" class="form-control" id="editar_whatsapp" name="editar_whatsapp" required="" data-msg-required="Por favor, informe o WhatsApp" placeholder="(00) 0 0000-0000" dmx-bind:value="data_detail_polo.data.whatsapp">
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Address -->
                    <div id="step3" dmx-show="modal_step.value == 2">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="editar_logradouro" class="form-label">Endereço completo</label>
                                <input type="text" class="form-control" id="editar_logradouro" name="editar_logradouro" required="" data-msg-required="Por favor, informe o endereço" dmx-bind:value="data_detail_polo.data.logradouro">
                            </div>
                            <div class="col-md-3">
                                <label for="editar_numero" class="form-label">Número</label>
                                <input type="text" class="form-control" id="editar_numero" name="editar_numero" required="" data-msg-required="Por favor, informe o número" dmx-bind:value="data_detail_polo.data.numero">
                            </div>
                            <div class="col-md-3">
                                <label for="editar_cep" class="form-label">CEP</label>
                                <input type="text" class="form-control" id="editar_cep" name="editar_cep" placeholder="00000-000" required="" data-msg-required="Por favor, informe o CEP" dmx-bind:value="data_detail_polo.data.cep">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_complemento" class="form-label">Complemento</label>
                                <input type="text" class="form-control" id="editar_complemento" name="editar_complemento" dmx-bind:value="data_detail_polo.data.complemento">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_bairro" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="editar_bairro" name="editar_bairro" required="" data-msg-required="Por favor, informe o bairro" dmx-bind:value="data_detail_polo.data.bairro">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_cidade" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="editar_cidade" name="editar_cidade" required="" data-msg-required="Por favor, informe a cidade" dmx-bind:value="data_detail_polo.data.cidade">
                            </div>
                            <div class="col-md-6">
                                <label for="editar_estado" class="form-label">Estado</label>
                                <select class="form-select" id="editar_estado" name="editar_estado" required="" data-msg-required="Por favor, selecione o estado" dmx-bind:value="data_detail_polo.data.uf">
                                    <option value="">Selecione o Estado</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amapá</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Ceará</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Pará</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="PR">Paraná</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piauí</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="editar_status" class="form-label">Status</label>
                                <select class="form-select" id="editar_status" name="editar_status" required="" data-msg-required="Por favor, selecione o estado" dmx-bind:value="data_detail_polo.data.status_empresa">
                                    <option value="">Selecione uma opção</option>
                                    <option value="Ativo">Ativo</option>
                                    <option value="Inativo">Inativo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Navigation Buttons -->
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" dmx-show="modal_step.value == 2" dmx-on:click="modal_step.setValue(1)">Voltar</button>
                    <button type="button" class="btn btn-primary" dmx-show="modal_step.value == 1" dmx-on:click="modal_step.setValue(2)">Próximo</button>
                    <button class="btn btn-success" dmx-show="modal_step.value == 2" dmx-on:click="editar_form_unidade.submit()">Atualizar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<meta name="ac:route" content="/security/backoffice/unidades-polos">
<dmx-preloader id="carregamento" spinner="cubeGrid" bgcolor="#0c0c0c" color="#3699FF" size="56"></dmx-preloader>

<div class="d-flex flex-row align-items-center justify-content-between mb-4">
    <div class="d-flex flex-column justify-content-start align-items-start">
        <h5 class="m-0 fw-bolder">Unidades/Polos</h5>
        <p class="sub-titulo mt-1 mb-0">Gestão de unidades - Polos do plano atual: {{plano_empresa.data.query_plano.polos_adicionais+1}}</p>
    </div>
    <div class="d-flex align-items-center">
        <button id="btn1" class="btn btn-primary" data-bs-target="#criar_modal_polo" data-bs-toggle="modal">Adicionar</button>
    </div>
</div>
<div class="d-flex sp-container mb-4 ">
    <table class="table table-dark mb-0 align-middle">
        <thead>
            <tr>
                <th class="pt-0 mt-0">Razao social</th>
                <th class="pt-0 mt-0">Nome fantasia</th>
                <th class="pt-0 mt-0">Nome polo</th>
                <th class="pt-0 mt-0">Cnpj</th>
                <th class="pt-0 mt-0">Whatsapp</th>
                <th class="pt-0 mt-0">Status empresa</th>
            </tr>
        </thead>
        <tbody is="dmx-repeat" dmx-generator="bs5table" dmx-bind:repeat="minhasempresas.data.query_empresas" id="tableRepeat1">
            <tr>
                <td dmx-on:click="run({condition:{outputType:'boolean',if:`status_empresa!=\'Inativo\'`,then:{steps:{run:{outputType:'text',action:`data_detail_polo.select(id_empresa);editar_modal_polo.show()`}}},else:{steps:{run:{outputType:'text',action:`alertas.warning(\'Para reativar uma unidade/polo é preciso abrir um suporte.\')`}}}}})"><i class="far fa-edit me-2 text-link-primary"></i> <span dmx-text="razao_social" class="text-link-primary"></span></td>
                <td dmx-text="nome_fantasia"></td>
                <td dmx-text="nome_polo"></td>
                <td dmx-text="cnpj"></td>
                <td dmx-text="whatsapp"></td>
                <td dmx-text="status_empresa"></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/ npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>

<script>
    $('#cep').mask('00000-000');
    $('#whatsapp').mask('(00) 0 0000-0000');
    $('#check_cnpj').mask('00.000.000/0000-00');
    $('#cnpj').mask('00.000.000/0000-00');
</script>