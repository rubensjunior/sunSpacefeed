<!-- Wappler include head-page="layouts/backoffice" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="postagens" appConnect="local" components="{dmxServerConnect:{},dmxSummernote:{},dmxSummernoteFileUpload:{},dmxDataTraversal:{}}" jquery_slim_35="cdn" -->
<meta name="ac:route" content="/security/backoffice/postagens">

<!-- Server Connect para carregar as postagens -->
<dmx-serverconnect id="lista_postagens" url="api/posts/list" dmx-param:page="posts_view.page || 1"></dmx-serverconnect>
<dmx-data-view id="posts_view" dmx-bind:data="lista_postagens.data.posts" pageSize="10"></dmx-data-view>

<!-- Lista de Postagens -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h5 class="mb-1">Postagens</h5>
        <p class="sub-titulo mb-0">Gerencie todas as postagens do feed</p>
    </div>
    <div>
        <button class="btn btn-primary" dmx-on:click="mostrar_form_postagem.setValue(true)">
            Nova Postagem
        </button>
    </div>
</div>
<div class="sp-container mb-4" dmx-hide="mostrar_form_postagem.value">

    <!-- Filtros e Busca -->

    <!-- Tabela de Postagens -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 60px" class="pt-0"></th>
                    <th class="pt-0">Título</th>
                    <th style="width: 120px" class="pt-0">Categoria</th>
                    <th style="width: 120px" class="pt-0">Status</th>
                    <th style="width: 160px" class="pt-0">Data</th>
                    <th style="width: 100px" class="text-end pt-0">Ações</th>
                </tr>
            </thead>
            <tbody is="dmx-repeat" id="repeat_posts" dmx-bind:repeat="posts_view.data">
                <tr>
                    <td>
                        <img dmx-bind:src="image" class="rounded" width="40" height="40" style="object-fit: cover">
                    </td>
                    <td>
                        <div dmx-text="title" class="fw-semibold text-white"></div>
                        <small class="text-muted" dmx-text="subtitle"></small>
                    </td>
                    <td>
                        <span class="badge" dmx-class:bg-primary="category == 'noticias'" dmx-class:bg-success="category == 'eventos'" dmx-class:bg-info="category == 'artigos'" dmx-class:bg-warning="category == 'dicas'" dmx-text="category">
                        </span>
                    </td>
                    <td>
                        <span class="badge" dmx-class:bg-success="status == 'published'" dmx-class:bg-secondary="status == 'draft'" dmx-text="status == 'published' ? 'Publicado' : 'Rascunho'">
                        </span>
                    </td>
                    <td dmx-text="created_at.formatDate('dd/MM/yyyy HH:mm')"></td>
                    <td class="text-end">
                        <button class="btn btn-link btn-sm p-0 me-2" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-link btn-sm p-0 text-danger" title="Excluir">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Paginação -->
    <div class="d-flex justify-content-between align-items-center mt-4" dmx-show="posts_view.data.length">
        <div class="fs-7 text-muted">
            Mostrando {{(posts_view.page - 1) * posts_view.pageSize + 1}} - {{Math.min(posts_view.page * posts_view.pageSize, posts_view.items)}} de {{posts_view.items}} postagens
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary btn-sm" dmx-on:click="posts_view.first()" dmx-bind:disabled="!posts_view.has.prev">
                <i class="fas fa-angle-double-left"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm" dmx-on:click="posts_view.prev()" dmx-bind:disabled="!posts_view.has.prev">
                <i class="fas fa-angle-left"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm" dmx-on:click="posts_view.next()" dmx-bind:disabled="!posts_view.has.next">
                <i class="fas fa-angle-right"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm" dmx-on:click="posts_view.last()" dmx-bind:disabled="!posts_view.has.next">
                <i class="fas fa-angle-double-right"></i>
            </button>
        </div>
    </div>
</div>

<style>
    /* Estilo dark para o Summernote */
    .note-editor.note-frame {
        background-color: var(--sp-container);
        border-color: rgba(255, 255, 255, 0.1);
    }

    .note-editor.note-frame .note-editing-area .note-editable {
        background-color: rgba(255, 255, 255, 0.05);
        color: #fff;
    }

    .note-editor .note-toolbar {
        background-color: rgba(255, 255, 255, 0.05);
        border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .note-editor .note-toolbar .note-btn {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        color: #fff;
    }

    .note-editor .note-toolbar .note-btn:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
</style>

<div class="row justify-content-center" dmx-show="mostrar_form_postagem.value">
    <div class="col-xl-10" is="dmx-view">
        <div class="sp-container mb-4">
            <div class="d-flex justify-content-between align-items-center mb-4">

                <div>
                    <h5 class="mb-1">Nova Postagem</h5>
                    <p class="sub-titulo mb-0">Crie e publique uma nova postagem para o feed.</p>
                </div>
                <div>
                    <button class="btn btn-outline-secondary" dmx-on:click="mostrar_form_postagem.setValue(false)">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </button>
                </div>
            </div>

            <form is="dmx-serverconnect-form" id="post_form" method="post" action="api/posts/create" enctype="multipart/form-data">
                <!-- Título da Postagem -->
                <div class="form-group mb-3">
                    <label for="post_title" class="form-label">Título</label>
                    <input type="text" class="form-control" id="post_title" name="title" required data-msg-required="Por favor, insira um título para a postagem" placeholder="Digite o título da postagem">
                </div>

                <!-- Subtítulo -->

                <!-- Imagem Principal -->


                <!-- Categoria -->


                <!-- Conteúdo -->
                <div class="form-group mb-3">
                    <label for="post_content" class="form-label">Conteúdo</label>
                    <textarea id="editor1" name="content" is="dmx-summernote" required data-msg-required="Por favor, insira o conteúdo da postagem" placeholder="Digite o conteúdo da postagem" dmx-bind:toolbar="[['style',['style']],['font',['bold','underline','clear']],['fontname',['fontname']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture','video']],['view',['fullscreen','codeview']]]" theme="bootstrap5" lang="pt-BR" height="300" dmx-on:summernote-file-upload="app.upload(arguments[1])" upload-path="/uploads/posts"></textarea>
                </div>

                <!-- Tags -->

                <div class="form-group mb-3">
                    <label for="post_image" class="form-label">Imagem Principal</label>
                    <input type="file" class="form-control" id="post_image" name="image" accept="image/*" image-max-width="1200" image-max-height="800" image-quality="85" required data-msg-required="Por favor, selecione uma imagem para a postagem">
                    <small class="text-muted">Tamanho recomendado: 1200x800px</small>
                </div>
                <div class="form-group mb-4">
                    <label class="form-label d-block">Status</label>
                    <div class="form-check form-check-inline">
                        <input type="radio" class="form-check-input" id="status_draft" name="status" value="draft" checked>
                        <label class="form-check-label" for="status_draft">Rascunho</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="radio" class="form-check-input" id="status_published" name="status" value="published">
                        <label class="form-check-label" for="status_published">Publicar</label>
                    </div>
                </div>

                <!-- Botões -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Salvar Postagem</button>
                    <button type="reset" class="btn btn-outline-secondary">Limpar Campos</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Configuração do tema escuro para o Summernote após o carregamento
document.addEventListener('DOMContentLoaded', function() {
    // Configurar o tema escuro do Summernote
    $('#editor1').on('summernote.init', function() {
        // Ajustar o tema dos popups
        $('.note-popover').addClass('note-dark');
        $('.note-dropdown-menu').addClass('bg-dark text-white border-secondary');
        $('.note-color-palette').find('.note-color-btn').css('border-color', 'rgba(255,255,255,0.2)');
        
        // Ajustar dialogs
        $('.note-modal-content').addClass('bg-dark text-white border-secondary');
        $('.note-modal-header').addClass('border-secondary');
        $('.note-modal-footer').addClass('border-secondary');
        
        // Ajustar botões nos diálogos
        $('.note-modal').find('.btn-primary').addClass('btn-primary');
        $('.note-modal').find('.btn-secondary').addClass('btn-outline-secondary');
        
        // Ajustar inputs nos diálogos
        $('.note-modal').find('.note-form-control').addClass('bg-dark text-white border-secondary');
        
        // Ajustar dropdowns
        $('.note-dropdown-menu').addClass('bg-dark border-secondary');
        $('.note-dropdown-item').addClass('text-white');
        $('.note-dropdown-item:hover').css({
            'background-color': 'rgba(255,255,255,0.1)',
            'color': '#fff'
        });
    });
});
</script>

<!-- Valor para controlar a exibição do formulário -->
<dmx-value id="mostrar_form_postagem" dmx-bind:value="false"></dmx-value>