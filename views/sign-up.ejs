<!-- Wappler include head-page="layouts/main" fontawesome_5="cdn" bootstrap5="local" is="dmx-app" id="signup" appConnect="local" components="{dmxValidator:{},dmxStateManagement:{},dmxFormatter:{},dmxMasking:{},dmxServerConnect:{},dmxDataTraversal:{}}" -->
<dmx-data-detail id="data_detail_plano_escolhido" dmx-bind:data="planos.data.queryPlanos" key="id_plano"></dmx-data-detail>
<dmx-serverconnect id="planos" url="/api/admin/listar-planos"></dmx-serverconnect>
<meta name="ac:route" content="/sign-up">

<div class="min-vh-100 d-flex align-items-center py-5" style="background-color: var(--sp-background)">
    <div class="container">
        <!-- Logo -->
        <div class="text-center mb-4">
            <img src="/assets/images/spacefeed-white.png" alt="SpaceFeed" width="200" class="img-fluid">
        </div>

        <!-- Registration Form -->
        <!-- Modern Progress Bar -->
        <div class="position-relative mb-5 mx-auto px-4" style="max-width: 800px;">
            <div class="steps-container">
                <div class="progress-line"></div>
                <div class="steps">
                    <div class="step" dmx-class:active="signup_step.value >= 1" dmx-class:complete="signup_step.value > 1">
                        <div class="step-circle">
                            <span>1</span>
                        </div>
                        <span class="step-label">Empresa</span>
                    </div>
                    <div class="step" dmx-class:active="signup_step.value >= 2" dmx-class:complete="signup_step.value > 2">
                        <div class="step-circle">
                            <span>2</span>
                        </div>
                        <span class="step-label">Endereço</span>
                    </div>
                    <div class="step" dmx-class:active="signup_step.value >= 3" dmx-class:complete="signup_step.value > 3">
                        <div class="step-circle">
                            <span>3</span>
                        </div>
                        <span class="step-label">Usuário</span>
                    </div>
                    <div class="step" dmx-class:active="signup_step.value >= 4" dmx-class:complete="signup_step.value > 4">
                        <div class="step-circle">
                            <span>4</span>
                        </div>
                        <span class="step-label">Plano</span>
                    </div>
                </div>
            </div>

            <!-- Form Container -->
            <div class="mx-auto bg-dark bg-opacity-25 rounded-3 border border-secondary border-opacity-10 mb-4" style="max-width: 800px;">
                <div class="p-4">
                    <!-- Multi-step Form Container -->
                    <form id="signup_form" method="post" action="/api/signup">
                        <!-- Step 1: Company Data -->
                        <div class="step-content" dmx-show="signup_step.value === 1">
                            <h3 class="text-center mb-4">Dados da Empresa</h3>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="razao_social" name="razao_social" placeholder="Razão Social" required data-msg-required="Por favor, informe a Razão Social">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="nome_fantasia" name="nome_fantasia" placeholder="Nome Fantasia" required data-msg-required="Por favor, informe o Nome Fantasia">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="nome_polo" name="nome_polo" placeholder="Nome do Polo" required data-msg-required="Por favor, informe o Nome do Polo">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control mask-cnpj" id="cnpj" name="cnpj" placeholder="CNPJ" required data-msg-required="Por favor, informe o CNPJ">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control mask-whatsapp" id="whatsapp" name="whatsapp" placeholder="WhatsApp" required data-msg-required="Por favor, informe o WhatsApp">
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Address -->
                        <div class="step-content" dmx-show="signup_step.value === 2">
                            <h3 class="text-center mb-4">Dados de Endereço</h3>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="logradouro" name="logradouro" placeholder="Endereço completo" required data-msg-required="Por favor, informe o Endereço">
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" id="numero" name="numero" placeholder="Número" required data-msg-required="Por favor, informe o Número">
                                </div>
                                <div class="col-md-3">
                                    <input type="text" class="form-control mask-cep" id="cep" name="cep" placeholder="CEP" required data-msg-required="Por favor, informe o CEP">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Complemento (Opcional)">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="bairro" name="bairro" placeholder="Bairro" required data-msg-required="Por favor, informe o Bairro">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="cidade" name="cidade" placeholder="Cidade" required data-msg-required="Por favor, informe a Cidade">
                                </div>
                                <div class="col-md-6">
                                    <select class="form-select" id="estado" name="estado" required data-msg-required="Por favor, selecione o Estado">
                                        <option value="">-- Selecione o Estado --</option>
                                        <option value="AC">Acre</option>
                                        <option value="AL">Alagoas</option>
                                        <option value="AP">Amapá</option>
                                        <option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option>
                                        <option value="CE">Ceará</option>
                                        <option value="DF">Distrito Federal</option>
                                        <option value="ES">Espírito Santo</option>
                                        <option value="GO">Goiás</option>
                                        <option value="MA">Maranhão</option>
                                        <option value="MT">Mato Grosso</option>
                                        <option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="PA">Pará</option>
                                        <option value="PB">Paraíba</option>
                                        <option value="PR">Paraná</option>
                                        <option value="PE">Pernambuco</option>
                                        <option value="PI">Piauí</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option>
                                        <option value="RO">Rondônia</option>
                                        <option value="RR">Roraima</option>
                                        <option value="SC">Santa Catarina</option>
                                        <option value="SP">São Paulo</option>
                                        <option value="SE">Sergipe</option>
                                        <option value="TO">Tocantins</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: User -->
                        <div class="step-content" dmx-show="signup_step.value === 3">
                            <h3 class="text-center mb-4">Dados do Usuário</h3>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="nome_completo" name="nome_completo" placeholder="Nome Completo" required data-msg-required="Por favor, informe o Nome Completo">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" id="nome_tratamento" name="nome_tratamento" placeholder="Nome de Tratamento" required data-msg-required="Por favor, informe o Nome de Tratamento">
                                </div>
                                <div class="col-md-12">
                                    <input type="email" class="form-control" id="email" name="email" placeholder="Email" required data-rule-email="true" data-msg-required="Por favor, informe o Email" data-msg-email="Por favor, informe um Email válido">
                                </div>
                                <div class="col-md-6">
                                    <input type="password" class="form-control" id="senha" name="senha" placeholder="Senha" required minlength="8" data-msg-required="Por favor, informe a Senha" data-msg-minlength="A senha deve ter no mínimo 8 caracteres">
                                </div>
                                <div class="col-md-6">
                                    <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha" placeholder="Confirmar Senha" required data-rule-equalto="#senha" data-msg-required="Por favor, confirme a Senha" data-msg-equalto="As senhas não conferem">
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Plan -->
                        <div class="step-content" dmx-show="signup_step.value === 4">
                            <h3 class="text-center mb-4">Escolha do Plano</h3>
                            <div class="row g-3">
                                <div class="col-lg-6">
                                    <select class="form-select" id="plano" name="plano" required data-msg-required="Por favor, selecione um Plano" dmx-bind:options="planos.data.queryPlanos" optiontext="nome+' - R$'+valor_base" optionvalue="id_plano" dmx-on:changed="data_detail_plano_escolhido.select(selectedValue)">
                                        <option value="">-- Selecione o Plano --</option>
                                    </select>
                                </div>
                                <div class="col-lg-6">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="polos_adicionais" name="polos_adicionais" placeholder="Quantidade de Polos Adicionais" value="0" min="0" dmx-on:input="polos_value.setValue(this.value.toNumber() * data_detail_plano_escolhido.data.valor_polo_extra)">
                                        <span class="input-group-text text-white opacity-75" style="background-color: var(--sp-container); border-color: rgba(255,255,255,0.1)">
                                            <small>R${{data_detail_plano_escolhido.data.valor_polo_extra}} por polo</small>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <p>{{data_detail_plano_escolhido.data.descricao}}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="d-flex align-items-center flex-row justify-content-between mb-2">
                                        <h6 class="m-0">Plano Mensal</h6>
                                        <div class="input-group" style="width: 140px;">
                                            <span class="input-group-text text-white border-0 bg-transparent px-2">R$</span>
                                            <input type="number" step="0.01" class="form-control text-end border-0 bg-transparent ps-0 pe-2" style="width: 100px;" id="valor_plano" placeholder="0" readonly dmx-bind:value="data_detail_plano_escolhido.data.valor_base.toNumber().toFixed(2)">
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center flex-row justify-content-between mb-2">
                                        <h6 class="m-0">Polos Adicionais</h6>
                                        <div class="input-group" style="width: 140px;">
                                            <span class="input-group-text text-white border-0 bg-transparent px-2">R$</span>
                                            <input type="number" step="0.01" class="form-control text-end border-0 bg-transparent ps-0 pe-2" style="width: 100px;" id="valor_polos" placeholder="0" readonly dmx-bind:value="(data_detail_plano_escolhido.data.valor_polo_extra * polos_adicionais.value).toNumber().toFixed(2)">
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center flex-row justify-content-between p-3 rounded-3 border border-opacity-10 border-light" id="resumo" style="background-color: var(--sp-container)">
                                        <h5 class="m-0">Total</h5>
                                        <div class="input-group" style="width: 140px;">
                                            <span class="input-group-text text-white border-0 bg-transparent px-2">R$</span>
                                            <input type="number" step="0.01" class="form-control text-end border-0 bg-transparent ps-0 pe-2" style="width: 100px;" id="valor_total" placeholder="0" readonly dmx-bind:value="(data_detail_plano_escolhido.data.valor_base.toNumber() + (data_detail_plano_escolhido.data.valor_polo_extra.toNumber() * polos_adicionais.value)).toFixed(2)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="d-flex justify-content-between mx-auto" style="max-width: 800px;">
                <button type="button" class="btn btn-lg btn-secondary" dmx-on:click="signup_step.setValue(signup_step.value - 1)" dmx-bind:disabled="signup_step.value === 1">
                    <i class="fas fa-arrow-left me-2"></i>Anterior
                </button>
                <button type="button" class="btn btn-lg btn-primary" dmx-show="signup_step.value < 4" dmx-on:click="signup_step.setValue(signup_step.value + 1)">
                    Próximo<i class="fas fa-arrow-right ms-2"></i>
                </button>
                <button type="submit" class="btn btn-lg btn-success" dmx-show="signup_step.value === 4" form="signup_form">
                    <i class="fas fa-check me-2"></i>Finalizar Cadastro
                </button>
            </div>
        </div>
    </div>

    <!-- Data Stores -->
    <dmx-value id="signup_step" dmx-bind:value="1"></dmx-value>
    <dmx-value id="valor_base" dmx-bind:value="0"></dmx-value>
    <dmx-value id="valor_total_pedido" dmx-bind:value="0"></dmx-value>
</div>