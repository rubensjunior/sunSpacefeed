{
  "meta": {
    "$_GET": [
      {
        "type": "text",
        "options": {
          "rules": {
            "core:required": {
              "message": "CNPJ é obrigatório"
            },
            "core:pattern": {
              "param": "^\\d{2}\\.?\\d{3}\\.?\\d{3}\\/?\\d{4}-?\\d{2}$",
              "message": "CNPJ deve estar no formato 00.000.000/0000-00"
            }
          }
        },
        "name": "cnpj"
      }
    ],
    "$_POST": [
      {
        "type": "text",
        "options": {
          "rules": {
            "core:required": {
              "message": "CNPJ é obrigatório"
            },
            "core:pattern": {
              "param": "^\\d{2}\\.?\\d{3}\\.?\\d{3}\\/?\\d{4}-?\\d{2}$",
              "message": "CNPJ deve estar no formato 00.000.000/0000-00"
            }
          }
        },
        "name": "cnpj"
      }
    ]
  },
  "exec": {
    "steps": [
      {
        "name": "cnpj",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{$_POST.cnpj || $_GET.cnpj}}"
        },
        "outputType": "text",
        "meta": []
      },
      {
        "name": "cleanCnpj",
        "module": "core",
        "action": "setvalue",
        "options": {
          "value": "{{cnpj.replace(/[^0-9]/g, '')}}"
        },
        "outputType": "text",
        "meta": []
      },
      {
        "name": "validate",
        "module": "core",
        "action": "condition",
        "options": {
          "if": "{{cleanCnpj.length === 14}}"
        },
        "success": [
          {
            "name": "formatCnpj",
            "module": "core",
            "action": "setvalue",
            "options": {
              "value": "{{cleanCnpj.replace(/^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/, '$1.$2.$3/$4-$5')}}"
            },
            "outputType": "text"
          },
          {
            "name": "success",
            "module": "core",
            "action": "response",
            "options": {
              "status": 200,
              "data": {
                "cnpj": "{{formatCnpj}}",
                "valid": true,
                "message": "CNPJ válido"
              }
            }
          }
        ],
        "else": [
          {
            "name": "error",
            "module": "core",
            "action": "response",
            "options": {
              "status": 400,
              "data": {
                "message": "CNPJ inválido - deve conter exatamente 14 dígitos",
                "valid": false
              }
            }
          }
        ],
        "outputType": "boolean"
      }
    ]
  }
}